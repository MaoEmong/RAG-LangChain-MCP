"""
preprocess/text_cleaner.py
============================================================
텍스트 정리 유틸리티 모듈.

기능:
- OCR이나 PDF에서 추출된 원본 텍스트는 불규칙한 개행/공백/특수문자를
    포함하는 경우가 많습니다. 이 모듈은 그런 텍스트를 RAG 파이프라인에
    적합한 일관된 형태로 정리합니다.

주요 처리 내용:
- 개행 문자 통일 (\r\n, \r → \n)
- 과도한 빈 줄(3줄 이상) 축소
- 연속 공백/탭을 단일 공백으로 축소
- 최종적으로 앞뒤 공백 제거

설계 포인트:
- 아주 공격적인 정규화는 원문 의미를 훼손할 수 있으므로 최소한의
    정리(가독성 향상 중심)를 목표로 합니다.
"""

import re

def clean_text(text: str) -> str:
    """
    텍스트를 정리하여 일관된 형식으로 변환합니다.
    
    수행하는 작업:
    1. 개행 문자 통일 (Windows/Mac/Linux 개행 → Unix 스타일)
    2. 과도한 빈 줄 제거 (3줄 이상 → 2줄)
    3. 과도한 공백/탭 제거 (2개 이상 → 1개)
    4. 앞뒤 공백 제거
    
    Args:
        text: 정리할 텍스트
    
    Returns:
        str: 정리된 텍스트
    
    Note:
        - 빈 문자열이나 None 입력 시 빈 문자열 반환
        - 텍스트 정리 후 앞뒤 공백은 제거됩니다
    """
    if not text:
        return ""
    
    # 1) 개행 문자 통일 (Windows/Mac → Unix 스타일)
    text = text.replace("\r\n", "\n").replace("\r", "\n")

    # 2) 과도한 공백/빈줄 정리
    text = re.sub(r"\n{3,}", "\n\n", text)  # 3줄 이상 빈 줄 → 2줄
    text = re.sub(r"[ \t]{2,}", " ", text)  # 2개 이상 공백/탭 → 1개

    return text.strip()
